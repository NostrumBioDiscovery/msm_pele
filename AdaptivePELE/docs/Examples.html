

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Manual &mdash; AdaptivePELE  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="AdaptivePELE  documentation" href="index.html"/>
        <link rel="next" title="Frequently Asked Questions" href="Problems.html"/>
        <link rel="prev" title="Welcome to AdaptivePELE’s documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> AdaptivePELE
          

          
          </a>

          
            
            
              <div class="version">
                v1.5.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#control-file-outline">Control file outline</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generalparams-block">generalParams block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parameters">Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simulation-block">simulation block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#templetized-pele-control-file">Templetized PELE control file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#clustering-block">clustering block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#thresholdcalculator">thresholdCalculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rmsd-clustering">rmsd clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#contactmap-clustering">contactMap clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#spawning-block">spawning block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#density-calculator">density calculator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#control-file-examples">Control File Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-1">Example 1</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2">Example 2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#analysis">Analysis</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dynamical-hooks">Dynamical hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#non-pdb-trajectories">Non-PDB trajectories</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Problems.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="AdaptivePELE.html">AdaptivePELE – Package Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">AdaptivePELE</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 







<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>User Manual</li>
    <li class="wy-breadcrumbs-aside">
      
          
          <a href="_sources/Examples.rst.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-manual">
<h1>User Manual<a class="headerlink" href="#user-manual" title="Permalink to this headline">¶</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>In order to have a running copy of AdaptivePELE <a class="reference internal" href="#apele" id="id1">[APELE]</a>, you need to install and compile cython files in the base folder with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">AdaptivePELE</span><span class="o">/</span><span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">AdaptivePELE</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build_ext</span> <span class="o">--</span><span class="n">inplace</span>
</pre></div>
</div>
<p>Also, if AdaptivePELE was not installed in a typical library directory, a common option is to add it to your local PYTHONPATH:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;/location/of/AdaptivePELE:$PYTHONPATH&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This page tries to give an overview of AdaptivePELE, enough to get it
up and running. The program aims to enhance the exploration of standard
molecular simulations by iteratively running short simulations,
assessing the exploration with a clustering, and spawning new trajectories
in <em>interesting</em> regions using the multi-armed bandit as a framework.
The algorithm can be summarized in the flow diagram shown below:</p>
<img alt="image trouble" class="align-center" src="_images/adaptiveDiagram.png" />
</div>
<div class="section" id="control-file-outline">
<h2>Control file outline<a class="headerlink" href="#control-file-outline" title="Permalink to this headline">¶</a></h2>
<p>AdaptivePELE is a Python program called with a parameter: the control
file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">adaptiveSampling</span> <span class="n">controlFile</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>The control file is a JSON document that permits tuning its behavior. It contains 4 blocks:
the general parameters, simulation parameters, clustering
parameters and spawning parameters. The first block refers to general
parameters such as the output path, initial structures, or whether to restart (resume) a simulation.
The other three blocks configure the three iterative steps of an adaptive run, and have a
<code class="docutils literal"><span class="pre">{&quot;type&quot;:str,</span> <span class="pre">&quot;params&quot;:{},</span> <span class="pre">&quot;optionalClasses&quot;:{}}</span></code> structure. Namely, the <strong>simulation</strong> block
chooses and tunes the propagation algorithm, typically PELE, the <strong>clustering</strong> block tunes the clustering method,
cluster sizes… and the <strong>spawning</strong> block selects the strategy to choose the most interesting
structures.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;generalParams&quot;</span> <span class="p">:</span> <span class="p">{},</span>
    <span class="s2">&quot;simulation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:{}},</span>
    <span class="s2">&quot;clustering&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:{}},</span>
    <span class="s2">&quot;spawning&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;params&quot;</span><span class="p">:{}}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="generalparams-block">
<h2>generalParams block<a class="headerlink" href="#generalparams-block" title="Permalink to this headline">¶</a></h2>
<p>These parameters control the general aspects of the simulation, such as the initial structures or the output path.
For example, if you consider that a simulation did not explore the energy landscape sufficiently,
it can be automatically resumed. In this case, if you change the clustering parameters from the previous run,
it will need the trajectory files to recluster all snapshots. Otherwise, it is enough with the automatically
handled clustering objects.
If you want to test the effect of using a particular cluster threshold or spawning parameter (see below),
using debug=true may be a great option.</p>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<p>The general parameters block has five possible fields:</p>
<ul class="simple">
<li><strong>restart</strong> (<em>boolean</em>, default=True): This parameter specifies whether you want to
continue a previous simulation or not. It requires the last epoch’s clustering object,
which is stored as a binary file to optimize disk usage.</li>
<li><strong>debug</strong> (<em>boolean</em>, default=False): Run adaptive in debug mode, without calling
any propagation algorithm. Typically used to tinker with the clustering/spawning.</li>
<li><strong>outputPath</strong> (<em>string</em>, mandatory): The path where the results of the simulation will be
written</li>
<li><strong>initialStructures</strong> (<em>list</em>, mandatory): The path(s) to the intial structure(s)</li>
<li><strong>writeAllClusteringStructures</strong> (<em>boolean</em>, default=False): Whether to write all the cluster
center structures as pdbs. Setting it to True is inneficient, and cluster center structures
can still be recovered from the binary clustering object.</li>
</ul>
<p>Additionaly, it can also have a nativeStructure parameter, a string containing
the path to the native structure. This structure will only be used to correct
the RMSD in case of symmetries. The symmetries will also have to be specified
(see <a class="reference internal" href="#clustering-block">clustering block</a>).</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;generalParams&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;restart&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;debug&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;outputPath&quot;</span><span class="p">:</span><span class="s2">&quot;simulationOutput&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nativeStructure&quot;</span> <span class="p">:</span> <span class="s2">&quot;nativeStructure.pdb&quot;</span><span class="p">,</span>
    <span class="s2">&quot;initialStructures&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;initial1.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;initial2.pdb&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="simulation-block">
<h2>simulation block<a class="headerlink" href="#simulation-block" title="Permalink to this headline">¶</a></h2>
<p>Currently, there are two implemented simulation types:</p>
<ul class="simple">
<li><strong>pele</strong>. <a class="reference external" href="https://pele.bsc.es/pele.wt">PELE</a> is a great tool to efficiently explore the energy landscape. Parameters have been optimized for its use.</li>
<li><strong>test</strong>. The test type has no real use outside of testing.</li>
</ul>
<p>We plan to implement an MD type in future versions.</p>
<div class="section" id="templetized-pele-control-file">
<h3>Templetized PELE control file<a class="headerlink" href="#templetized-pele-control-file" title="Permalink to this headline">¶</a></h3>
<p>In order to run adaptivePELE, PELE control file needs to be templetized. In particular:</p>
<ul class="simple">
<li><strong>MultipleComplexes”</strong>: AdaptivePELE requieres the use of multiple complexes: <code class="docutils literal"><span class="pre">&quot;MultipleComplex&quot;:</span> <span class="pre">[</span> <span class="pre">$COMPLEXES</span> <span class="pre">]</span></code></li>
<li><strong>seed</strong>: The seed needs to be templetized: <code class="docutils literal"><span class="pre">&quot;seed&quot;:</span> <span class="pre">$SEED</span></code></li>
<li><strong>outputPath</strong>: The output path needs to be changed for: <code class="docutils literal"><span class="pre">&quot;reportPath&quot;:</span> <span class="pre">&quot;$OUTPUT_PATH/report&quot;</span></code></li>
<li><strong>numberOfPeleSteps</strong>: The number of pele steps needs to be templetized as <code class="docutils literal"><span class="pre">&quot;numberOfPeleSteps&quot;:</span> <span class="pre">$PELE_STEPS</span></code></li>
</ul>
<p>Optionally other fields might be templetized as well:</p>
<ul class="simple">
<li><strong>fixedCenter</strong>: The center of the simulation box is templetized as <code class="docutils literal"><span class="pre">&quot;fixedCenter&quot;:</span> <span class="pre">$BOX_CENTER</span></code></li>
<li><strong>radius</strong>: The radius of the simulation box is templetized as <code class="docutils literal"><span class="pre">&quot;radius&quot;:</span> <span class="pre">$BOX_RADIUS</span></code></li>
</ul>
</div>
<div class="section" id="id2">
<h3>parameters<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>When using PELE as a propagator, the following parameters are mandatory:</p>
<ul class="simple">
<li><strong>iterations</strong> (<em>integer</em>, mandatory): Number of adaptive sampling iterations to run</li>
<li><strong>processors</strong> (<em>integer</em>, mandatory): Number of processors to use with PELE</li>
<li><strong>peleSteps</strong> (<em>integer</em>, mandatory):  Number of PELE steps in a epoch (iteration)</li>
<li><strong>seed</strong> (<em>integer</em>, mandatory): Seed for the random number generator</li>
<li><strong>controlFile</strong> (<em>string</em>, mandatory): Path to the templetized PELE control file (see below)</li>
</ul>
<p>Optionally, you can also use the following parameters:</p>
<ul class="simple">
<li><strong>data</strong> (<em>string</em>, default=MareNostrum or Life cluster path): Path to the Data folder needed for PELE</li>
<li><strong>documents</strong> (<em>string</em>, default=MareNostrum or Life cluster path): Path to the Documents folder needed for PELE</li>
<li><strong>executable</strong> (<em>string</em>, default=MareNostrum or Life cluster path): Path to the Pele executable folder</li>
<li><strong>modeMovingBox</strong> (<em>string</em>, default=None, possible values={<em>unbinding</em>, <em>binding</em>}): Whether to dynamically set the center of the simulation box along an exit or entrance simulation</li>
<li><strong>boxCenter</strong> (<em>list</em>, default=None): List with the coordinates of the simulation box center</li>
<li><strong>boxRadius</strong> (<em>int</em>, default=20): Value of the simulation box radius</li>
<li><strong>runEquilibration</strong> (<em>bool</em>, default=False): Whether to run a short
equilibration or burn-in simulation for each initial structure</li>
<li><strong>equilibrationLength</strong> (<em>int</em>, default=50): Number of steps for the
equilibration run</li>
<li><strong>equilibrationMode</strong> (<em>string</em>, default=”equilibrationSelect”): Choose the
mode of the equilbration run, <em>equilibrationSelect</em> selects one of the
structures as a representative as a function of distance and energy, while
<em>equilibrationLastSnapshot</em> selects the last snapshot of each trajectory as
representatives and <em>equilibrationCluster</em> clusters the output of the 25%
best energy structures in the equilibration by the center of mass.</li>
<li><strong>numberEquilibrationStructures</strong> (<em>int</em>, default=10): Number of clusters to
obtain from the <em>equilibrationCluster</em> structure selection (see
<strong>equilibrationMode</strong> for more details)</li>
</ul>
<p>Additionally, the block may have an exit condition that stops the execution:</p>
<ul>
<li><p class="first"><strong>exitCondition</strong> (<em>dict</em>, default=None): Block that specifies an exit condition for the simulation.
Currently two types are implemented: <em>metric</em> and
<em>metricMultipleTrajectories</em>.</p>
<ul>
<li><p class="first"><strong>metric</strong> :
this type accepts a <em>metricCol</em> which represents a column in the report file, an <em>exitValue</em>
which represents a value for the metric and a <em>condition</em> parameter which can
be either “&lt;” or “&gt;”, default value is “&lt;”. The simulation will terminate after the metric
written in the <em>metricCol</em> reaches a value smaller or greater than <em>exitValue</em>, depending on the condition specified.
An example of the exit condition block that would terminate the program after a trajectory reaches a value of less
than 2 for the fifth column (4th starting to count from 0) of the report file would look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;exitCondition&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;metricCol&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;exitValue&quot;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="s2">&quot;condition&quot;</span> <span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>metricMultipleTrajectories</strong> :
this type accepts a <em>metricCol</em> which represents a column in the report file, an <em>exitValue</em>
which represents a value for the metric, a <em>condition</em> parameter which can
be either “&lt;” or “&gt;”, default value is “&lt;” and a <em>numberTrajectories</em> parameter which determines how many independent trajectories
have to meet the condition for the simulation to stop. The simulation will terminate after the metric
written in the <em>metricCol</em> reaches a value smaller or greater than <em>exitValue</em>, depending on the condition specified for a
number of trajectories greater or equal than <em>numberTrajectories</em>. An example of the exit condition block that would terminate the
program after 10 trajectories reach a value of more than 2 for the fifth column (4th starting to count from 0) of the report
file would look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;exitCondition&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;metricMultipleTrajectories&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;metricCol&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;exitValue&quot;</span> <span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
        <span class="s2">&quot;condition&quot;</span> <span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;numberTrajectoriess&quot;</span> <span class="p">:</span> <span class="mi">10</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<p>Example of a minimal simulation block:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;simulation&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;pele&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;iterations&quot;</span> <span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
        <span class="s2">&quot;processors&quot;</span> <span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
        <span class="s2">&quot;peleSteps&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">30689</span><span class="p">,</span>
        <span class="s2">&quot;controlFile&quot;</span> <span class="p">:</span> <span class="s2">&quot;templetizedPELEControlFile.conf&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="clustering-block">
<h2>clustering block<a class="headerlink" href="#clustering-block" title="Permalink to this headline">¶</a></h2>
<p>Currently there are two functional types of clustering:</p>
<ul class="simple">
<li><strong>rmsd</strong>, which solely uses the ligand rmsd</li>
<li><strong>contactMap</strong>, which uses a protein-ligand contact map matrix</li>
</ul>
<p>These clusterings are based on the leader algorithm, an extremely fast clustering method that in the
worst case makes <em>kN</em> comparisons, where <em>N</em> is the number of snapshots to cluster and <em>k</em> the number of existing clusters.
The procedure is as follows. Given some clusters, a conformation is said to belong to a cluster
when it differs in less than a certain metric threshold (e.g. ligand RMSD)
to the corresponding cluster center. Cluster centers are always compared in the same order, and,
if there is no similar cluster, it generates a new one.</p>
<p>Aside from the speed, a big advantage of using this method
is that it permits the user to define different criteria in different regions.
This way, we can optimize the number of clusters, giving more importance to regions with more interactions,
potentially being more metastable.</p>
<p>In order to measure the potential metastability,
we use the ratio of the number of protein-ligand heavy atom contacts over the number of ligand heavy atoms, <em>r</em>.
Two atoms are considered to be in contact if the distance between
them is less than a certain <strong>contactThreshold</strong> (8Å by default). Although these values depend on the particular
protein-ligand geometry and ligand size, this measure is more ligand-independent compared to the overall
number of contacts and a value of 1 typically indicates that the ligand is on the surface entering a protein pocket.
We encourage the use of default parameters with very few exceptions such as in the study
of the diffusion of ions or tiny molecules (e.g. a oxygen molecule).</p>
<div class="section" id="thresholdcalculator">
<h3>thresholdCalculator<a class="headerlink" href="#thresholdcalculator" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>constant</strong>, where all clusters have the same threshold. A sound value may be 3Å.</li>
<li><strong>heaviside</strong> (default), where thesholds (values) are assigned according to a set of step functions that
vary according to a ratio of protein-ligand contacts and ligand size , <em>r</em>, (conditions, see below). The values and conditions
of change are defined with two lists. The condition list is iterated until <em>r</em> &gt; condition[i], and the used
threshold is values[i]. If r &lt;= conditions[i] for all i, it returns the last element in values.
Thresholds typically vary from 5Å in the bulk to 2Å in protein pockets. This method is preferred, as it
optimizes the number of clusters, giving more importance to regions with more contacts and interactions,
where metastability occurs. Default values: [2,3,4,5], default conditions: [1, 0.75, 0.5].</li>
</ul>
</div>
<div class="section" id="rmsd-clustering">
<h3>rmsd clustering<a class="headerlink" href="#rmsd-clustering" title="Permalink to this headline">¶</a></h3>
<p>In the <strong>rmsd</strong> clustering, if the RMSD between two ligand conformations is less than
a certain threshold, the conformation is added to the cluster, and otherwise, a new cluster
is generated.</p>
</div>
<div class="section" id="contactmap-clustering">
<h3>contactMap clustering<a class="headerlink" href="#contactmap-clustering" title="Permalink to this headline">¶</a></h3>
<p>The <strong>contactMap</strong> uses the similarity between protein-ligand contact maps.
The contact map is a boolean matrix with the protein
atoms (or a subset of them, typically one or two per residue) as columns and
ligand atoms (typically only heavy atoms) as rows, and a value of True indicates a contact.
There are currently three implemented methods to evaluate the similarity of contactMaps:</p>
<ul class="simple">
<li><strong>Jaccard</strong>, which calulates the Jaccard Index (<a class="reference external" href="https://en.wikipedia.org/wiki/Jaccard_index">Wikipedia page</a>). The recommended values using the heaviside threshold calculator are [0.375, 0.5, 0.55, 0.7] for the conditions [1, 0.75 , 0.5].</li>
<li><strong>correlation</strong>, which calculates the correlation between the two matrices</li>
<li><strong>distance</strong>, which evaluates the similarity of two contactMaps by calculating the ratio of the number of differences over the average of elements in the contacts maps.</li>
</ul>
</div>
<div class="section" id="id3">
<h3>parameters<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>ligandResname</strong> (<em>string</em>, default=”“): Ligand residue name in the PDB (if necessary)</li>
<li><strong>ligandChain</strong> (<em>string</em>, default=”“): Ligand chain (if necessary)</li>
<li><strong>ligandResnum</strong> (<em>int</em>, default=0): Ligand residue number (if necessary). If 0 or not specified, it is ignored. The ligand ought to be univoquely identified with any combination of this and the two former parameters</li>
<li><strong>contactThresholdDistance</strong> (<em>float</em>, default=8): Maximum distance at which two atoms have to
be separated to be considered in contact</li>
<li><strong>symmetries</strong> (<em>list</em>, default=[]) List of symmetry groups of key:value maps with the names of atoms
that are symmetrical in the ligand</li>
<li><strong>similarityEvaluator</strong> (<em>string</em>, mandatory)  Name of the method to evaluate the similarity
of contactMaps, only available and mandatory in the contactMap clustering</li>
<li><strong>alternativeStructure</strong> (<em>bool</em>, default=False): It stores alternative spawning structures within each cluster to be used in the spawning (see below). Any two pairs of alternative structures within a cluster are separated a minimum distance of cluster_threshold_distance/2.</li>
</ul>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>A typical setting of the rmsd clustering is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;clustering&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ligandResname&quot;</span> <span class="p">:</span> <span class="s2">&quot;AEN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;contactThresholdDistance&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
        <span class="s2">&quot;symmetries&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;3225:C3:AEN&quot;</span><span class="p">:</span><span class="s2">&quot;3227:C5:AEN&quot;</span><span class="p">,</span><span class="s2">&quot;3224:C2:AEN&quot;</span><span class="p">:</span><span class="s2">&quot;3228:C6:AEN&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;3230:N1:AEN&quot;</span><span class="p">:</span> <span class="s2">&quot;3231:N2:AEN&quot;</span><span class="p">}]</span>
    <span class="p">},</span>
    <span class="s2">&quot;thresholdCalculator&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;heaviside&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;values&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
            <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>which, given the default options, is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;clustering&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;ligandResname&quot;</span> <span class="p">:</span> <span class="s2">&quot;AEN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;symmetries&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;3225:C3:AEN&quot;</span><span class="p">:</span><span class="s2">&quot;3227:C5:AEN&quot;</span><span class="p">,</span><span class="s2">&quot;3224:C2:AEN&quot;</span><span class="p">:</span><span class="s2">&quot;3228:C6:AEN&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;3230:N1:AEN&quot;</span><span class="p">:</span> <span class="s2">&quot;3231:N2:AEN&quot;</span><span class="p">}]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this exemple, clusters having a contacts ration greater than 1 have a
treshold of 2, those with contacts ratio between 1 and 0.75 have a treshold of
3, between 0.75 and 0.5 a threshold of 4 and the rest have a threshold size of
5. This means that for greater contacts ratio, typically closer to the binding site,
the cluster size will be smaller and therefore those regions will be more
finely discretized.</p>
</div>
</div>
<div class="section" id="spawning-block">
<h2>spawning block<a class="headerlink" href="#spawning-block" title="Permalink to this headline">¶</a></h2>
<p>Finally, trajectories are spawned in different <em>interesting</em> clusters, according to a reward function.
There are several implemented strategies:</p>
<ul class="simple">
<li><strong>sameWeight</strong>: Uniformly distributes the processors over all clusters</li>
<li><strong>inverselyProportional</strong>: Distributes the processors with a weight that is inversely proportional to the cluster population.</li>
<li><strong>epsilon</strong>: An <em>epsilon</em> fraction of processors are distributed proportionally to the value of a metric, and the rest are inverselyProportional distributed.  A param <strong>n</strong> can be specified to only consider the <em>n</em> clusters with best metric.</li>
<li><strong>variableEpsilon</strong>: Equivalent to epsilon, with an epsilon value changing over time</li>
<li><strong>independent</strong>: Trajectories are run independently, as in the original PELE. It may be useful to restart simulations or to use the analysis scripts built for AdaptivePELE.</li>
<li><strong>UCB</strong>: Upper confidence bound.</li>
<li><strong>FAST</strong>: FAST strategy (see J. Chem. Theory Comput., 2015, 11 (12), pp 5747–5757).</li>
</ul>
<p>According to our experience, the best strategies are <strong>inverselyProportional</strong> and <strong>epsilon</strong>, guided with either PELE binding energy or the RMSD to the bound pose if available.</p>
<div class="section" id="density-calculator">
<h3>density calculator<a class="headerlink" href="#density-calculator" title="Permalink to this headline">¶</a></h3>
<p>Each cluster is assigned a relative density of points compared to other clusters.
Again, and in analogy to the threshold calculator, the aim is to give more emphasis to interesting regions.
There are two types of density calculators:</p>
<ul class="simple">
<li><strong>constant</strong> (or <strong>null</strong>, default), which assigns the same density to all the clusters regardless of the number of contacts</li>
<li><strong>heaviside</strong>, which assigns different densities using a heaviside function, much like the thresholdCalculator (values and conditions are mandatory)</li>
<li><strong>continuous</strong>, which assings increasing densities for an increasing number of contacts. Default values, if <strong>r</strong> &gt; 1, density = 8, otherwise, density = 64.0/(-4 <strong>r</strong> + 6)^3</li>
<li><strong>exitContinuous</strong>, which assings decreasing densities for an increasing number of contacts. Default values, if <strong>r</strong> &gt; 1, density = 1/8, otherwise, density = (-4 <strong>r</strong> + 6)^3/64.0</li>
</ul>
</div>
<div class="section" id="id4">
<h3>parameters<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>reportFilename</strong> (<em>string</em>, mandatory): Basename to match the report file with metrics. E.g. “report”.</li>
<li><strong>metricColumnInReport</strong> (<em>integer</em>, mandatory): Column of the report file that contains the metric of interest (zero indexed)</li>
<li><strong>epsilon</strong> (<em>float</em>, mandatory in <strong>epsilon</strong> spawning): The fraction of the processors that will be assigned according to the selected metric</li>
<li><strong>metricWeights</strong> (<em>string</em>, default=linear): Selects how to distribute the weights of the cluster according to its metric, two options: linear (proportional to metric) or Boltzmann weigths (proportional to exp(-metric/T). Needs to define the temperature <strong>T</strong>.</li>
<li><strong>T</strong> (<em>float</em>, default=1000): Temperature, only used for Boltzmann weights</li>
<li><strong>condition</strong> (<em>string</em>, optional): Selects wether to take into account maximum or minimum values in epsilon related spawning, values are <em>min</em> or <em>max</em></li>
</ul>
<p>The following parameters are mandatory for <strong>variableEpsilon</strong>:</p>
<ul class="simple">
<li><strong>varEpsilonType</strong> (<em>string</em>,default=linear): Selects the type of variation for the epsilon value. At the moment only a linear variation is implemented</li>
<li><strong>maxEpsilon</strong> (<em>float</em>): Maximum value for epsilon</li>
<li><strong>minEpsilon</strong> (<em>float</em>): Minimum value for epsilon</li>
<li><strong>variationWindow</strong> (<em>integer</em>): Last iteration over which to change the epsilon value</li>
<li><strong>maxEpsilonWindow</strong> (<em>integer</em>): Number of iteration with epsilon=maxEpsilon</li>
<li><strong>period</strong> (<em>integer</em>) Variation period (in number of iterations)</li>
</ul>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;spawning&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;inverselyProportional&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;reportFilename&quot;</span> <span class="p">:</span> <span class="s2">&quot;report&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;spawning&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;epsilon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;reportFilename&quot;</span> <span class="p">:</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metricColumnInReport&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;epsilon&quot;</span> <span class="p">:</span> <span class="mf">0.25</span>
    <span class="p">},</span>
    <span class="s2">&quot;density&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;continuous&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="control-file-examples">
<h2>Control File Examples<a class="headerlink" href="#control-file-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>The first example makes use of default parameters (used in the AdaptivePELE paper <a class="reference internal" href="#apele" id="id5">[APELE]</a>).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;generalParams&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;restart&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;outputPath&quot;</span><span class="p">:</span><span class="s2">&quot;example1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nativeStructure&quot;</span> <span class="p">:</span> <span class="s2">&quot;native.pdb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;initialStructures&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;initial1.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;initial2.pdb&quot;</span><span class="p">]</span>
    <span class="p">},</span>

    <span class="s2">&quot;simulation&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;pele&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;iterations&quot;</span> <span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">&quot;processors&quot;</span> <span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="s2">&quot;peleSteps&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">30689</span><span class="p">,</span>
            <span class="s2">&quot;controlFile&quot;</span> <span class="p">:</span> <span class="s2">&quot;templetizedPELEControlFile.conf&quot;</span>

        <span class="p">}</span>
    <span class="p">},</span>

    <span class="s2">&quot;clustering&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ligandResname&quot;</span> <span class="p">:</span> <span class="s2">&quot;AEN&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="s2">&quot;spawning&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;inverselyProportional&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;reportFilename&quot;</span> <span class="p">:</span> <span class="s2">&quot;report&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To summarize, below there is a screenshot of a simple functional control file:</p>
</div>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>A more complete (although not so comprehensible) example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;generalParams&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;restart&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;debug&quot;</span> <span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;outputPath&quot;</span><span class="p">:</span><span class="s2">&quot;example2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;writeAllClusteringStructures&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;nativeStructure&quot;</span> <span class="p">:</span> <span class="s2">&quot;native.pdb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;initialStructures&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;initial1.pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;initial2.pdb&quot;</span><span class="p">]</span>
    <span class="p">},</span>

    <span class="s2">&quot;spawning&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;epsilon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;reportFilename&quot;</span> <span class="p">:</span> <span class="s2">&quot;report&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metricColumnInReport&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;epsilon&quot;</span><span class="p">:</span><span class="mf">0.1</span>
        <span class="p">},</span>
        <span class="s2">&quot;density&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;null&quot;</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="s2">&quot;simulation&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;pele&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;executable&quot;</span> <span class="p">:</span> <span class="s2">&quot;PELE++/bin/rev12025/Pele_rev12025_mpi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span> <span class="p">:</span> <span class="s2">&quot;PELE++/data/rev12025/Data&quot;</span><span class="p">,</span>
            <span class="s2">&quot;documents&quot;</span> <span class="p">:</span> <span class="s2">&quot;PELE++/Documents/rev12025&quot;</span><span class="p">,</span>
            <span class="s2">&quot;iterations&quot;</span> <span class="p">:</span> <span class="mi">25</span><span class="p">,</span>
            <span class="s2">&quot;processors&quot;</span> <span class="p">:</span> <span class="mi">51</span><span class="p">,</span>
            <span class="s2">&quot;peleSteps&quot;</span> <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">30689</span><span class="p">,</span>
            <span class="s2">&quot;controlFile&quot;</span> <span class="p">:</span> <span class="s2">&quot;/gpfs/scratch/bsc72/bsc72755/adaptiveSampling/data/3ptb/3ptb_a_1000.conf&quot;</span>

        <span class="p">}</span>
    <span class="p">},</span>

    <span class="s2">&quot;clustering&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;ligandResname&quot;</span> <span class="p">:</span> <span class="s2">&quot;AEN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contactThresholdDistance&quot;</span> <span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s2">&quot;symmetries&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;3225:C3:AEN&quot;</span><span class="p">:</span><span class="s2">&quot;3227:C5:AEN&quot;</span><span class="p">,</span><span class="s2">&quot;3224:C2:AEN&quot;</span><span class="p">:</span><span class="s2">&quot;3228:C6:AEN&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;3230:N1:AEN&quot;</span><span class="p">:</span> <span class="s2">&quot;3231:N2:AEN&quot;</span><span class="p">}]</span>
        <span class="p">},</span>
        <span class="s2">&quot;thresholdCalculator&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;heaviside&quot;</span><span class="p">,</span>
            <span class="s2">&quot;params&quot;</span> <span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;values&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
                <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="output">
<h2>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h2>
<p>The output for each epoch is redirected to a different folder, with a name that matches the epoch number. For example, if we run three epochs, we will have three folders named
0, 1, and 2.
Aside from the regular simulation program output each directory contains a clustering subdirectory with the clustering summary information, and
eventually, the cluster center pdb files and the clustering object. This clustering object is used to restart simulations, and only that of the last
finished epoch is kept for disk usage optimization.
If we change a clustering parameter in a restart run, AdaptivePELE will recluster all the snapshots, which will fail if previous trajectories are not present.</p>
<div class="section" id="analysis">
<h3>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h3>
<p>In order to analyse simulation results, a bunch of scripts are provided in <code class="docutils literal"><span class="pre">AdaptivePELE/analysis</span></code>. Get help to run them with: <code class="docutils literal"><span class="pre">python</span> <span class="pre">&lt;script&gt;</span> <span class="pre">-h</span></code></p>
<p>Example to print column 5 evolution with gnuplot:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">plotAdaptive</span> <span class="mi">4</span> <span class="mi">2</span> <span class="mi">5</span> <span class="n">report_</span> <span class="o">-</span><span class="n">lines</span> <span class="o">|</span> <span class="n">gnuplot</span> <span class="o">-</span><span class="n">persist</span>
</pre></div>
</div>
<p>It prints the evolution of column 5 (e.g. RMSD) in report_* files with lines in epochs of 4 steps.</p>
<p>Example to print BE against RMSD with gnuplot:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">plotAdaptive</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="n">report_</span> <span class="o">-</span><span class="n">points</span> <span class="o">|</span> <span class="n">gnuplot</span> <span class="o">-</span><span class="n">persist</span>
</pre></div>
</div>
<p>It prints the column 6 against column 5 with points. Epoch length is ignored in this case</p>
<p>To plot the evolution of the number of clusters along the simulation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">numberOfClusters</span> <span class="o">-</span><span class="n">filename</span> <span class="s2">&quot;plot&quot;</span>
</pre></div>
</div>
<p>It shows the evolution of the total number of clusters, and the number of clusters divided in different densities and cluster thresholds.
It also prints a histogram with the ratio of counts <em>r</em> (see above). When <code class="docutils literal"><span class="pre">-filename</span></code> is provided, it saves the plots as png files.</p>
</div>
</div>
<div class="section" id="dynamical-hooks">
<h2>Dynamical hooks<a class="headerlink" href="#dynamical-hooks" title="Permalink to this headline">¶</a></h2>
<p>Starting from version 4.2, the option of dynamically changing the cluster sizes
is implemented using a hook. This hook is a function that is passed to the
adaptive main function which accepts two arguments: <em>clustering</em> and <em>outputPath</em>
and returns two arguments: <em>clustering</em> and <em>hasChanged</em>. <em>clustering</em> refers to  the clustering object, while <em>hasChanged</em> is a boolean that marks whether any change has been done to the clustering object in the hook function. If so, the data is reclustered before starting the new iteration. One example of such function would look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hook_function</span><span class="p">(</span><span class="n">clustering</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">):</span>
    <span class="n">hasChanged</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clustering</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">clustering</span><span class="o">.</span><span class="n">thresholdCalculator</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">hasChanged</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">clustering</span><span class="p">,</span> <span class="n">hasChanged</span>
</pre></div>
</div>
</div>
<div class="section" id="non-pdb-trajectories">
<h2>Non-PDB trajectories<a class="headerlink" href="#non-pdb-trajectories" title="Permalink to this headline">¶</a></h2>
<p>Starting from version 1.5, AdaptivePELE supports working with non-PDB
trajectories by relying on the mdtraj library <a class="reference internal" href="#mdtraj" id="id6">[MDTRAJ]</a>, with only minor changes in
the exposed interface of the atomset module. However, some caution is needed
when using mdtraj to convert between formats:</p>
<ul class="simple">
<li>Mdtraj does not keep the chain names, for example, if we have a pdb with 2
chains, <em>A</em> for the protein and <em>L</em> for the ligand, mdtraj will rewrite the
PDB chains as <em>A</em> and <em>B</em></li>
<li>Mdtraj does not keep protonation states, for example, if we have histidines
with different states (<em>HIS</em>, <em>HID</em> and <em>HIP</em>) all will be written as <em>HIS</em></li>
<li>Mdtraj stores atomic coordinates in nanometers which leads to lose of
precision when converting to Amstrong, however this only affects the second
or third decimal, so most structures should be fine</li>
</ul>
<p>To overcome these issues, the splitTrajectories script in the analysis
subpackage can be used::</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">splitTrajectory</span> <span class="mi">0</span><span class="o">/</span><span class="n">trajectory_10</span><span class="o">.</span><span class="n">xtc</span> <span class="o">-</span><span class="n">o</span> <span class="n">output_pdb</span> <span class="o">--</span><span class="n">top</span> <span class="n">topology</span><span class="o">.</span><span class="n">pdb</span> <span class="o">--</span><span class="n">structs</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The top parameter stands for topology and is necessary for dealing with xtc
trajectories. Typically is a pdb file with the description of the system. The
call shown above will extract the second, fifth and tenth snapshots of the file
0/trajectory_10.xtc into the folder output_pdb, as separate files for a system that can be
described with the file topology.pdb</p>
<p>If a whole trajectory has to be converted one can also use the
convertTrajectory script, also in the analysis subpackage:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">AdaptivePELE</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">convertTrajectory</span> <span class="mi">0</span><span class="o">/</span><span class="n">trajectory_3</span><span class="o">.</span><span class="n">xtc</span> <span class="o">--</span><span class="n">top</span> <span class="n">topology</span><span class="o">.</span><span class="n">pdb</span> <span class="o">-</span><span class="n">o</span> <span class="n">trajectory_0_3</span><span class="o">.</span><span class="n">pdb</span> <span class="o">--</span><span class="nb">dir</span> <span class="n">outupt_pdb</span>
</pre></div>
</div>
<p>As before, the top parameter stands for topology. The
call shown above will convert the file 0/trajectory_3.xtc into the file output_pdb/trajectory_0_3.pdb, for a system that can be
described with the file topology.pdb</p>
<table class="docutils citation" frame="void" id="apele" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[APELE]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id5">2</a>)</em> Daniel Lecina, Joan F. Gilabert, and Victor Guallar. Adaptive simulations, towards interactive protein-ligand modeling. Scientific Reports, 7(1):8466, 2017, <a class="reference external" href="https://www.nature.com/articles/s41598-017-08445-5">https://www.nature.com/articles/s41598-017-08445-5</a></td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="mdtraj" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[MDTRAJ]</a></td><td>Robert&nbsp;T. McGibbon et. al. MDTraj: A Modern Open Library for the Analysis of Molecular Dynamics Trajectories. Biophysical Journal, Volume 109, Issue 8, 2015, <a class="reference external" href="http://mdtraj.org">http://mdtraj.org</a></td></tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Problems.html" class="btn btn-neutral float-right" title="Frequently Asked Questions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to AdaptivePELE’s documentation!" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Daniel Lecina, Joan Francesc Gilabert.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>